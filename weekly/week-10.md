# Week-10 (10/27/20 & 10/29/20)

## I. Overview 

- React MVC Project Overview
  - [Project 2 - Product/Service Site - React](https://people.rit.edu/arwigm/430/)
  - Videos:
    - [Rich Media 2 - Week 12.1 - React MVC Project Overview](https://www.youtube.com/watch?v=Kl1II4VpgOE)
    - [Rich Media 2 - Week 11.1 - React FSCs](https://www.youtube.com/watch?v=kAMb0sEp9js) - *Functional Stateless Components*
    - [Rich Media 2 - Week 11.2 - React Class Components](https://www.youtube.com/watch?v=EzgxSVN-AzI)
  - DomoMakers (see myCourses for PDFs and due dates):
    - What's a Domo? - https://knowyourmeme.com/memes/domo
    - [DomoMaker A Done](https://domomaker-a-2201.herokuapp.com)

## II. DomoMaker A - Assignment Walkthrough

- The architecture of this app is very similar to the *Simple Models* HW
  - **app.js**  loads the app dependencies and start up the [express](https://www.npmjs.com/package/express) server
  - **router.js** calls the various routes with code defined in the **controllers/** folder
  - a **views/** folder contains [handlebars](https://handlebarsjs.com/) templates of the site's three pages (**app**, **signup**, **login**)
  - a **models/** folder that contains [mongoose](https://www.npmjs.com/package/mongoose) models (one per file) such as `Account` and (coming soon!) `Domo`
    - we add "class" methods to these models with the `statics` property
  - MVC in action:
    - note that when a user comes to the site, the router tells a ***controller*** to render the proper ***view***
    - when the user interacts with a ***view*** (for example signing up for a new account and clicking the Submit button), a message (endpoint) is routed back to the relevant ***controller***
    - the ***controllers*** will call the appropriate methods defined in the ***models***, and then render (draw) the ***views***
- Note: the **client.js** code is all [jQuery](https://jquery.com/):
  - why? `jQuery.animate()` I guess ...
  - here's a nice overview - [jQuery Fundamentals - jquery Basics](http://jqfundamentals.com/chapter/jquery-basics)
- Create a user account (name and password) with **signup.handlebars**
  - `<input id="pass" type="password" name="pass" placeholder="password"/>`
  - note that the `type` is [`"password"`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/password)
  - **models/Account.js** is a mongoose model for the user's account
    - properties are `username`,`salt`,`password` (encrypted), `createdDate`
    - we encrypt the typed in password with node's built-in **crypto** library:
      - https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2_password_salt_iterations_keylen_digest_callback
      - https://nodejs.org/api/crypto.html#crypto_crypto_randombytes_size_callback
  - `controllers/Account.js` uses `signup()` to call `AccountModel.generateHash()` and generate an encrypted password
  - password encryption:
    - clear text:
      - https://simple.wikipedia.org/wiki/Cleartext
      - https://www.theverge.com/2019/4/18/18485599/facebook-instagram-passwords-plain-text-millions-users
    - encryption
      - https://www.howtogeek.com/howto/33949/htg-explains-what-is-encryption-and-how-does-it-work/
      - https://blueimp.github.io/JavaScript-MD5/
      - https://md5calc.com/hash/md5/12345678
    - rainbow tables:
      - https://www.geeksforgeeks.org/understanding-rainbow-table-attack/
      - https://en.wikipedia.org/wiki/Rainbow_table
    - salt
      - https://security.stackexchange.com/questions/17421/how-to-store-salt
      - https://security.stackexchange.com/questions/100898/why-store-a-salt-along-side-the-hashed-password
      - https://security.stackexchange.com/questions/211/how-to-securely-hash-passwords
  - Mongo database
    - locally you will be using `mongod` (probably), and on Heroku you will be using your MongoDB cloud account
    - you will be able to see the following in a mongo client (`mongo` in Terminal/Powershell or the **MongoDB Compass** app):
      - the *database name* is set via `dbURL` (in **app.js**) and is `"DomoMaker"`
      - the *collection* is named `"accounts"` and is autogenerated by `mongoose` in **models/Account.js**
      - each user is represented by a *document* in the `accounts` collection
      - handy mongo commands you can use while you are debugging & testing:
        - `show dbs`
        - `use DomoMaker`
        - `show collections`
        - `db.accounts.find().pretty()` // show all documents in the accounts collection
        - `db.accounts.remove({})` // delete all documents in the accounts collection
- Login to an existing account with **login.handlebars**

<hr>

## III. DomoMaker-B - Assignment Walkthrough

1) DomoMaker-B:
  - See myCourses for PDF and dropbox/due date
  - See ***tonys_class*** channel in Discord - there I noted 4 DomoMaker-B PDF typos
  - now you can add Domos to the database, "owned" and only visible to the current logged in user
  - working version here: https://domomaker-b-2201.herokuapp.com/maker
  - handy mongo commands you can use while you are debugging & testing:
    - `show dbs`
    - `use DomoMaker`
    - `show collections`
    - `db.accounts.find().pretty()` // show all documents in the accounts collection
    - `db.accounts.remove({})` // delete all documents in the accounts collection
    - `db.domos.find().pretty()` // show all documents in the domos collection
    - `db.domos.remove({})` // delete all documents in the domos collection
- you also might want to completely get rid of ("drop") a collection - in particular if you changed the associated mongoose schema of the documents
  - `db.accounts.drop()` // drop accounts collection which deletes the index and all documents in that collection
  - `db.domos.drop()` // drop domos collection which deletes the index and all documents in that collection


2) HTTP sessions
- `const session = require('express-session');`
- https://www.npmjs.com/package/express-session
- `AccountSchema.statics.toAPI`
- `req.session` - To store or access session data, simply use the request property req.session, which is (generally) serialized as JSON by the store, so nested objects are typically fine.
- https://www.npmjs.com/package/underscore
- https://mongoosejs.com/docs/schematypes.html#objectids
- `return DomoModel.find(search).select('name age').lean().exec(callback);`






<hr><hr>  

| <-- Previous Unit | Home | Next Unit -->
| --- | --- | --- 
| [**week-9.md**](week-9.md)  |  [**IGME-430 Home**](../README.md) | **week-11.md**
